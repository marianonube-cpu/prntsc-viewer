<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Visor de Prnt.sc</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #111;
            color: #eee;
            font-family: sans-serif;
            position: relative;
        }
        #loader {
            font-size: 1.2em;
        }
        img {
            max-width: 100vw;
            max-height: 100vh;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }
        #error-container {
            text-align: center;
            padding: 20px;
        }
        #error-container a {
            color: #8af;
        }
        #lang-switcher {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.9em;
            z-index: 10;
        }
        #lang-switcher a {
            text-decoration: none;
            color: #ccc;
            padding: 3px;
        }
        #lang-switcher a.active {
            font-weight: bold;
            text-decoration: underline;
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="lang-switcher">
        <a href="#" data-lang="es" class="active">ES</a> |
        <a href="#" data-lang="en">EN</a>
    </div>

    <div id="loader" data-i18n="loading">Cargando...</div>
    <div id="image-container"></div>
    <div id="error-container" style="display: none;"></div>

    <script>
        const translations = {
            es: {
                pageTitle: "Visor de Prnt.sc",
                loading: "Cargando...",
                noIdFound: "No se encontró un ID de imagen",
                noIdInstructions: "Por favor, añade el ID de la imagen de prnt.sc a la URL después de un '#'.",
                example: "Ejemplo:",
                fetchError: "Error al acceder a la página de prnt.sc",
                imageLoadError: "No se pudo cargar la imagen final desde:",
                imageFindError: "No se pudo encontrar la URL de la imagen en la página de prnt.sc. Es posible que el enlace esté roto o la estructura de la página haya cambiado.",
                genericError: "Ha ocurrido un error",
                tryDirectLink: "Intenta visitar el enlace directamente:"
            },
            en: {
                pageTitle: "Prnt.sc Viewer",
                loading: "Loading...",
                noIdFound: "No Image ID Found",
                noIdInstructions: "Please add the prnt.sc image ID to the URL after a '#'.",
                example: "Example:",
                fetchError: "Error accessing the prnt.sc page",
                imageLoadError: "Could not load the final image from:",
                imageFindError: "Could not find the image URL on the prnt.sc page. The link may be broken or the page structure may have changed.",
                genericError: "An error has occurred",
                tryDirectLink: "Try visiting the link directly:"
            }
        };

        let currentLang = 'es';

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.innerHTML = translations[lang][key];
            });
            document.querySelectorAll('#lang-switcher a').forEach(a => {
                a.classList.remove('active');
                if (a.getAttribute('data-lang') === lang) {
                    a.classList.add('active');
                }
            });
        }

        async function main() {
            const loader = document.getElementById('loader');
            const imageContainer = document.getElementById('image-container');
            const errorContainer = document.getElementById('error-container');
            
            const userLang = new URLSearchParams(window.location.search).get('lang');
            const initialLang = (userLang === 'en' || userLang === 'es') ? userLang : 'es';
            setLanguage(initialLang);

            document.querySelectorAll('#lang-switcher a').forEach(a => {
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = e.target.getAttribute('data-lang');
                    setLanguage(lang);
                    // No need to reload, just update text
                });
            });

            const imageId = window.location.hash.substring(1);

            if (!imageId) {
                loader.style.display = 'none';
                errorContainer.style.display = 'block';
                errorContainer.innerHTML = `
                    <h2>${translations[currentLang].noIdFound}</h2>
                    <p>${translations[currentLang].noIdInstructions}</p>
                    <p>${translations[currentLang].example} <code>.../prntsc_viewer.html#MSyd2ujFfgV0</code></p>
                `;
                return;
            }

            const prntscUrl = `https://prnt.sc/${imageId}`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(prntscUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error(`${translations[currentLang].fetchError} (código: ${response.status})`);
                }
                const html = await response.text();

                const match = html.match(/(https:\/\/img\.lightshot\.app\/[^\s"]+)/);

                if (match && match[1]) {
                    const imageUrl = match[1];
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = `Image from ${prntscUrl}`;
                    
                    img.onload = () => {
                        loader.style.display = 'none';
                        imageContainer.appendChild(img);
                    };
                    img.onerror = () => {
                         throw new Error(`${translations[currentLang].imageLoadError} ${imageUrl}`);
                    };
                } else {
                    throw new Error(translations[currentLang].imageFindError);
                }
            } catch (error) {
                loader.style.display = 'none';
                errorContainer.style.display = 'block';
                errorContainer.innerHTML = `
                    <h2>${translations[currentLang].genericError}</h2>
                    <p>${error.message}</p>
                    <p>${translations[currentLang].tryDirectLink} <a href="${prntscUrl}" target="_blank">${prntscUrl}</a></p>
                `;
                console.error(error);
            }
        }

        document.addEventListener('DOMContentLoaded', main);
    </script>

</body>
</html>